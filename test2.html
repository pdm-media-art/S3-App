<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>SecureStay: Analytics &amp; Process</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    /* ==========================
       Global
       ========================== */

    *,
    *::before,
    *::after {
      box-sizing: border-box;
    }

    :root {
      --bg-main: #020617;
      --border-subtle: #1e293b;
      --border-strong: #334155;

      --text-main: #e5e7eb;
      --text-muted: #9ca3af;
      --text-soft: #6b7280;

      --accent: #f97316;         /* Orange: Primary allgemein */
      --accent-soft: #fb923c;
      --accent-soft2: #fed7aa;

      --accent-incident: #14b8a6; /* Türkis: Incident-Button */
      --accent-incident-soft: #2dd4bf;

      --danger: #f97373;

      --radius-lg: 16px;
      --radius-pill: 999px;

      --shadow-soft: 0 18px 40px rgba(15, 23, 42, 0.95);
      --shadow-card: 0 14px 30px rgba(15, 23, 42, 0.75);

      --transition-fast: 0.18s ease-out;
      --transition-med: 0.25s ease;
    }

    html,
    body {
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
      background: radial-gradient(circle at top, #020617 0, #000 55%, #020617 100%);
      color: var(--text-main);
      min-height: 100vh;
    }

    body {
      display: flex;
      flex-direction: column;
    }

    /* ==========================
       Layout / Header / Nav
       ========================== */

    .app-header {
      display: flex;
      align-items: center;
      padding: 16px 32px;
      background: linear-gradient(90deg, #020617, #020617 50%, #020617);
      border-bottom: 1px solid var(--border-subtle);
      box-shadow: 0 6px 20px rgba(15, 23, 42, 0.6);
      position: sticky;
      top: 0;
      z-index: 50;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .logo-icon {
      height: 32px;
      width: 32px;
      border-radius: 10px;
      box-shadow: 0 0 0 2px rgba(248, 250, 252, 0.06);
      object-fit: contain;
      background: radial-gradient(circle at top left, #f97316, #0f172a);
    }

    .logo-text {
      font-weight: 600;
      font-size: 1.05rem;
      letter-spacing: 0.04em;
      text-transform: uppercase;
      color: #f9fafb;
    }

    .app-nav {
      display: flex;
      gap: 8px;
      padding: 10px 32px 12px;
      background: radial-gradient(circle at top, #020617 0, #020617 40%, #000 100%);
      border-bottom: 1px solid var(--border-subtle);
    }

    .nav-btn {
      border-radius: 999px;
      border: 1px solid transparent;
      padding: 7px 15px;
      background: transparent;
      color: var(--text-muted);
      font-size: 0.88rem;
      font-weight: 500;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      transition: background var(--transition-fast), color var(--transition-fast),
        border-color var(--transition-fast), transform 0.08s ease-out;
    }

    .nav-btn:hover {
      background: rgba(15, 23, 42, 0.9);
      border-color: var(--border-subtle);
      color: #e5e7eb;
      transform: translateY(-0.5px);
    }

    .nav-btn.active {
      background: rgba(15, 23, 42, 1);
      border-color: var(--accent-soft2);
      color: #fef3c7;
      box-shadow: 0 0 0 1px rgba(249, 115, 22, 0.8),
        0 12px 28px rgba(15, 23, 42, 0.9);
    }

    .app-main {
      padding: 20px 32px 32px;
      max-width: 1200px;
      width: 100%;
      margin: 0 auto;
    }

    /* ==========================
       Seiten / Animation
       ========================== */

    .page {
      display: none;
      animation: fadeIn 0.22s ease-out;
    }

    .page.active {
      display: block;
    }

    .page-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
      margin-bottom: 18px;
    }

    .page-header h1 {
      font-size: 1.3rem;
      margin: 0;
    }

    .page-header p {
      margin: 4px 0 0;
      font-size: 0.85rem;
      color: var(--text-soft);
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(4px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* ==========================
       Cards / Dashboard
       ========================== */

    .cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(210px, 1fr));
      gap: 16px;
    }

    .card {
      background: radial-gradient(
        circle at top left,
        rgba(248, 250, 252, 0.03),
        #020617 55%
      );
      border-radius: var(--radius-lg);
      padding: 16px 16px 14px;
      border: 1px solid rgba(30, 64, 175, 0.38);
      box-shadow: var(--shadow-card);
      position: relative;
      overflow: hidden;
    }

    .card-title {
      font-size: 0.82rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--text-soft);
      margin-bottom: 6px;
    }

    .card-value {
      font-size: 1.7rem;
      font-weight: 600;
      color: #fefce8;
    }

    .card-heading {
      font-size: 0.98rem;
      font-weight: 600;
      margin-bottom: 6px;
    }

    .card-body {
      font-size: 0.84rem;
      color: var(--text-muted);
    }

    .section-title {
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--text-soft);
      margin: 20px 0 8px;
    }

    ul.small-list {
      padding-left: 18px;
      margin: 4px 0 0;
      font-size: 0.84rem;
    }

    ul.small-list li {
      margin-bottom: 3px;
    }

    .two-columns {
      display: grid;
      grid-template-columns: minmax(0, 1.8fr) minmax(0, 1.2fr);
      gap: 18px;
      align-items: flex-start;
    }

    @media (max-width: 900px) {
      .two-columns {
        grid-template-columns: 1fr;
      }
    }

    .pill {
      display: inline-flex;
      align-items: center;
      border-radius: var(--radius-pill);
      border: 1px solid var(--border-subtle);
      padding: 3px 10px;
      font-size: 0.75rem;
      color: var(--text-soft);
      gap: 6px;
      margin-right: 6px;
    }

    .pill-dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: var(--accent);
    }

    /* ==========================
       Buttons
       ========================== */

    .primary-btn {
      background: var(--accent);
      color: #0f172a;
      border-radius: var(--radius-pill);
      border: none;
      padding: 7px 18px;
      font-size: 0.88rem;
      font-weight: 600;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      box-shadow: 0 8px 18px rgba(248, 113, 22, 0.55);
      transition: background var(--transition-fast), transform 0.09s ease-out,
        box-shadow var(--transition-fast);
    }

    .primary-btn:hover {
      background: var(--accent-soft);
      transform: translateY(-0.5px);
      box-shadow: 0 14px 28px rgba(248, 113, 22, 0.65);
    }

    .secondary-btn {
      background: transparent;
      color: var(--text-main);
      border-radius: var(--radius-pill);
      border: 1px solid var(--border-subtle);
      padding: 7px 16px;
      font-size: 0.86rem;
      font-weight: 500;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: border-color var(--transition-fast),
        background var(--transition-fast), color var(--transition-fast),
        transform 0.08s ease-out;
    }

    .secondary-btn:hover {
      border-color: var(--border-strong);
      background: rgba(15, 23, 42, 0.9);
      transform: translateY(-0.5px);
    }

    .incident-btn {
      background: var(--accent-incident) !important;
      color: #0f172a !important;
      box-shadow: 0 8px 18px rgba(20, 184, 166, 0.55) !important;
    }

    .incident-btn:hover {
      background: var(--accent-incident-soft) !important;
      box-shadow: 0 14px 30px rgba(20, 184, 166, 0.7) !important;
    }

    .icon-btn {
      border: none;
      background: transparent;
      color: var(--text-soft);
      font-size: 1.5rem;
      cursor: pointer;
      padding: 0;
      line-height: 1;
      transition: color var(--transition-fast), transform 0.09s ease-out;
    }

    .icon-btn:hover {
      color: var(--accent-soft);
      transform: scale(1.05);
    }

    /* ==========================
       Filter / Inputs
       ========================== */

    .filters {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 14px;
    }

    .filters input,
    .filters select {
      background: #020617;
      border-radius: var(--radius-pill);
      border: 1px solid var(--border-subtle);
      padding: 7px 14px;
      font-size: 0.88rem;
      color: var(--text-main);
      outline: none;
      min-width: 180px;
      transition: border-color var(--transition-fast),
        box-shadow var(--transition-fast), background var(--transition-fast);
    }

    .filters input::placeholder {
      color: var(--text-soft);
    }

    .filters input:focus,
    .filters select:focus {
      border-color: var(--accent-soft);
      box-shadow: 0 0 0 1px rgba(249, 115, 22, 0.45);
      background: rgba(15, 23, 42, 0.96);
    }

    /* ==========================
       Tables
       ========================== */

    .table-wrapper {
      background: radial-gradient(circle at top left, #020617, #020617);
      border-radius: var(--radius-lg);
      border: 1px solid var(--border-subtle);
      box-shadow: var(--shadow-soft);
      overflow: hidden;
      margin-bottom: 18px;
    }

    .data-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.85rem;
    }

    .data-table thead {
      background: radial-gradient(
        circle at top left,
        rgba(15, 23, 42, 0.8),
        #020617
      );
    }

    .data-table th,
    .data-table td {
      padding: 9px 12px;
      border-bottom: 1px solid rgba(15, 23, 42, 0.9);
      text-align: left;
    }

    .data-table th {
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      font-size: 0.7rem;
      color: var(--text-soft);
      border-bottom: 1px solid var(--border-subtle);
    }

    .data-table tbody tr:nth-child(even) {
      background: rgba(15, 23, 42, 0.85);
    }

    .data-table tbody tr:nth-child(odd) {
      background: rgba(15, 23, 42, 0.95);
    }

    .data-table tbody tr:hover {
      background: rgba(15, 23, 42, 0.9);
    }

    .table-action-btn {
      border-radius: 999px;
      border: 1px solid var(--border-subtle);
      background: rgba(15, 23, 42, 0.9);
      color: var(--text-main);
      font-size: 0.78rem;
      padding: 3px 9px;
      cursor: pointer;
      margin-right: 4px;
      transition: background var(--transition-fast),
        border-color var(--transition-fast), transform 0.08s ease-out;
    }

    .table-action-btn:hover {
      background: rgba(15, 23, 42, 1);
      border-color: var(--accent-soft);
      transform: translateY(-0.5px);
    }

    .table-action-btn.danger {
      border-color: rgba(248, 113, 113, 0.7);
      color: #fecaca;
      background: rgba(127, 29, 29, 0.4);
    }

    .table-action-btn.danger:hover {
      background: rgba(153, 27, 27, 0.6);
    }

    /* ==========================
       Risikomatrix
       ========================== */

    .risk-matrix {
      margin-top: 12px;
      padding: 14px;
      border-radius: 16px;
      border: 1px solid #1e293b;
      background: radial-gradient(circle at top, #020617, #020617 60%, #000 100%);
      box-shadow: var(--shadow-soft);
    }

    .risk-matrix-grid {
      display: grid;
      grid-template-columns: repeat(10, minmax(0, 1fr));
      gap: 3px;
    }

    .risk-matrix-cell {
      aspect-ratio: 1 / 1;
      border-radius: 4px;
      font-size: 0.7rem;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #f9fafb;
      cursor: default;
      position: relative;
      overflow: hidden;
    }

    .risk-matrix-cell.low {
      background: rgba(22, 163, 74, 0.45);
    }

    .risk-matrix-cell.medium {
      background: rgba(234, 179, 8, 0.7);
    }

    .risk-matrix-cell.high {
      background: rgba(239, 68, 68, 0.8);
    }

    .risk-matrix-cell:not(:empty)::after {
      content: "";
      position: absolute;
      inset: 0;
      border-radius: inherit;
      box-shadow: inset 0 0 0 1px rgba(15, 23, 42, 0.4);
    }

    /* ==========================
       Modals
       ========================== */

    .modal {
      position: fixed;
      inset: 0;
      display: none;
      z-index: 1000;
      align-items: center;
      justify-content: center;
      pointer-events: none;
    }

    .modal.open {
      display: flex;
      pointer-events: auto;
    }

    .modal-backdrop {
      position: absolute;
      inset: 0;
      background: rgba(15, 23, 42, 0.7);
      backdrop-filter: blur(10px);
    }

    .modal-content {
      position: relative;
      background: #020617;
      color: var(--text-main);
      border-radius: 16px;
      padding: 20px 20px 16px;
      max-width: 720px;
      width: 100%;
      max-height: 90vh;
      overflow: auto;
      box-shadow: var(--shadow-soft);
      border: 1px solid rgba(148, 163, 184, 0.5);
    }

    .modal-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      margin-bottom: 14px;
    }

    .modal-header h2 {
      margin: 0;
      font-size: 1.1rem;
    }

    .form {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .form label {
      display: flex;
      flex-direction: column;
      gap: 4px;
      font-size: 0.86rem;
      color: var(--text-soft);
    }

    .form input,
    .form select,
    .form textarea {
      background: #020617;
      border-radius: 8px;
      border: 1px solid var(--border-subtle);
      padding: 7px 9px;
      color: var(--text-main);
      font-size: 0.87rem;
      outline: none;
      transition: border-color var(--transition-fast),
        box-shadow var(--transition-fast), background var(--transition-fast);
    }

    .form input:focus,
    .form select:focus,
    .form textarea:focus {
      border-color: var(--accent-soft);
      box-shadow: 0 0 0 1px rgba(249, 115, 22, 0.45);
      background: rgba(15, 23, 42, 0.98);
    }

    .form textarea {
      resize: vertical;
      min-height: 70px;
    }

    .form-row-2 {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 10px;
    }

    .modal-footer {
      display: flex;
      justify-content: flex-end;
      gap: 10px;
      margin-top: 14px;
    }

    /* ==========================
       Radar / Spinnweben-Matrix
       ========================== */

    .radar-card {
      margin-top: 1.5rem;
    }

    .radar-wrapper {
      position: relative;
      width: 100%;
      max-width: 480px;
      margin: 0 auto;
      aspect-ratio: 1 / 1;
    }

    .radar-wrapper canvas {
      width: 100%;
      height: 100%;
      display: block;
    }

    /* ==========================
       Roadmap / Milestones
       ========================== */

    .roadmap-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(230px, 1fr));
      gap: 16px;
    }

    .roadmap-phase-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }

    .roadmap-phase-title {
      font-size: 0.9rem;
      font-weight: 600;
    }

    .roadmap-phase-badge {
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--text-soft);
    }

    .milestone-list {
      list-style: none;
      padding: 0;
      margin: 6px 0 0;
      font-size: 0.84rem;
    }

    .milestone-item {
      display: flex;
      align-items: flex-start;
      gap: 8px;
      padding: 4px 0;
      border-radius: 8px;
      transition: background var(--transition-fast);
    }

    .milestone-item:hover {
      background: rgba(15, 23, 42, 0.85);
    }

    .milestone-item input[type="checkbox"] {
      margin-top: 2px;
      accent-color: #f97316;
      cursor: pointer;
    }

    .milestone-label {
      cursor: pointer;
      color: var(--text-muted);
    }

    .milestone-label.done {
      text-decoration: line-through;
      color: var(--text-soft);
    }

    .roadmap-summary {
      margin-bottom: 14px;
      font-size: 0.85rem;
      color: var(--text-soft);
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 8px;
      justify-content: space-between;
    }

    .progress-bar {
      flex: 1 1 180px;
      height: 8px;
      border-radius: 999px;
      background: #020617;
      border: 1px solid var(--border-subtle);
      overflow: hidden;
    }

    .progress-bar-inner {
      height: 100%;
      width: 0;
      background: linear-gradient(90deg, #f97316, #fb923c);
      border-radius: inherit;
      transition: width 0.2s ease-out;
    }

    /* ==========================
       Headings
       ========================== */

    h1,
    h2,
    h3 {
      color: #f9fafb;
    }

    h2 {
      font-size: 1.05rem;
    }

    h3 {
      font-size: 0.96rem;
      margin-top: 8px;
      margin-bottom: 4px;
      color: var(--text-muted);
    }

    @media (max-width: 768px) {
      .app-header {
        padding: 12px 16px;
      }

      .app-nav {
        padding: 8px 16px 10px;
        overflow-x: auto;
      }

      .app-main {
        padding: 16px;
      }

      .modal-content {
        max-width: 95vw;
        padding: 16px 14px;
      }
    }
  </style>
</head>
<body>
  <header class="app-header">
    <div class="logo">
      <!-- Falls kein echtes Logo vorhanden ist, bleibt der Hintergrundgradient sichtbar -->
      <div class="logo-icon"></div>
      <span class="logo-text">SecureStay: Analytics</span>
    </div>
  </header>

  <nav class="app-nav">
    <button class="nav-btn active" data-page="dashboard">Dashboard</button>
    <button class="nav-btn" data-page="threats">Threat Sheet</button>
    <button class="nav-btn" data-page="assets">Assets</button>
    <button class="nav-btn" data-page="incidents">Incidents</button>
    <button class="nav-btn" data-page="process">Prozess &amp; BI-Flow</button>
    <button class="nav-btn" data-page="roadmap">Roadmap</button>
  </nav>

  <main class="app-main">
    <!-- Dashboard -->
    <section id="page-dashboard" class="page active">
      <h1>Dashboard</h1>
      <div class="cards">
        <div class="card">
          <div class="card-title">Sicherheitsindex Umfeld</div>
          <div class="card-value" id="envIndex">–</div>
        </div>
        <div class="card">
          <div class="card-title">Sicherheitsindex Objekt</div>
          <div class="card-value" id="objIndex">–</div>
        </div>
        <div class="card">
          <div class="card-title">Offene Risiken</div>
          <div class="card-value" id="openRisks">0</div>
        </div>
        <div class="card">
          <div class="card-title">Offene Incidents</div>
          <div class="card-value" id="openIncidents">0</div>
        </div>
      </div>

      <!-- Spinnweben-Matrix / Radar-Chart -->
      <div class="card radar-card">
        <div class="card-title">Spinnweben-Matrix Sicherheitsdimensionen</div>
        <div class="radar-wrapper">
          <canvas id="securityRadar" width="400" height="400"></canvas>
        </div>
      </div>
    </section>

    <!-- Threat Sheet -->
    <section id="page-threats" class="page">
      <div class="page-header">
        <h1>Threat Sheet (Risiken)</h1>
        <button id="btnAddRisk" class="primary-btn">+ Neues Risiko</button>
      </div>

      <div class="filters">
        <input
          type="text"
          id="riskSearch"
          placeholder="Suche nach Risikoname..."
        />
        <select id="riskTypeFilter">
          <option value="">Alle Risikoarten</option>
          <option value="Security">Security</option>
          <option value="Safety">Safety</option>
          <option value="Compliance">Compliance</option>
          <option value="Datenschutz">Datenschutz</option>
          <option value="Brandschutz">Brandschutz</option>
          <option value="IT">IT</option>
        </select>
      </div>

      <div class="table-wrapper">
        <table class="data-table">
          <thead>
            <tr>
              <th>ID</th>
              <th>Risiko</th>
              <th>Risikoart</th>
              <th>Priorität</th>
              <th>Status</th>
              <th>Risikowert</th>
              <th>Aktionen</th>
            </tr>
          </thead>
          <tbody id="riskTableBody">
            <!-- wird per JS gefüllt -->
          </tbody>
        </table>
      </div>

      <h2>Risikomatrix</h2>
      <div id="riskMatrix" class="risk-matrix">
        <!-- wird per JS gebaut -->
      </div>
    </section>

    <!-- Assets -->
    <section id="page-assets" class="page">
      <div class="page-header">
        <h1>Assets &amp; Vulnerabilität</h1>
        <button id="btnAddAsset" class="primary-btn">+ Neues Asset</button>
      </div>

      <div class="filters">
        <input
          type="text"
          id="assetSearch"
          placeholder="Suche nach Asset-Name, Typ, Location..."
        />
        <select id="assetZoneFilter">
          <option value="">Alle Zonen</option>
          <option value="Rot">Rot</option>
          <option value="Gelb">Gelb</option>
          <option value="Grün">Grün</option>
        </select>
      </div>

      <div class="table-wrapper">
        <table class="data-table">
          <thead>
            <tr>
              <th>ID</th>
              <th>Name</th>
              <th>Typ</th>
              <th>Location</th>
              <th>Owner</th>
              <th>Vuln-Index</th>
              <th>Zone</th>
              <th>Aktionen</th>
            </tr>
          </thead>
          <tbody id="assetTableBody">
            <!-- per JS -->
          </tbody>
        </table>
      </div>
    </section>

    <!-- Incidents -->
    <section id="page-incidents" class="page">
      <div class="page-header">
        <h1>Incident Reporting</h1>
        <button id="btnAddIncident" class="primary-btn incident-btn">
          + Neuer Vorfall
        </button>
      </div>

      <div class="filters">
        <input
          type="text"
          id="incidentSearch"
          placeholder="Suche nach Ort, Art, Beschreibung..."
        />
        <select id="incidentCategoryFilter">
          <option value="">Alle Kategorien</option>
          <option value="Security-Vorfälle">Security-Vorfälle</option>
          <option value="Safety-Vorfälle">Safety-Vorfälle</option>
          <option value="Compliance">Compliance</option>
          <option value="Datenschutz">Datenschutz</option>
          <option value="Brandschutz">Brandschutz</option>
          <option value="IT-Vorfälle">IT-Vorfälle</option>
        </select>
        <select id="incidentStatusFilter">
          <option value="">Alle Status</option>
          <option value="offen">offen</option>
          <option value="in Bearbeitung">in Bearbeitung</option>
          <option value="geschlossen">geschlossen</option>
        </select>
      </div>

      <div class="table-wrapper">
        <table class="data-table">
          <thead>
            <tr>
              <th>ID</th>
              <th>Datum/Zeit</th>
              <th>Ort</th>
              <th>Kategorie</th>
              <th>Art</th>
              <th>Schweregrad</th>
              <th>Status</th>
              <th>Aktionen</th>
            </tr>
          </thead>
          <tbody id="incidentTableBody">
            <!-- per JS -->
          </tbody>
        </table>
      </div>
    </section>

    <!-- Prozess & BI-Flow -->
    <section class="page" id="page-process">
      <div class="page-header">
        <div>
          <h1>Prozess &amp; BI-Flow – Risiko- &amp; Sicherheitsmanagement</h1>
          <p>
            End-to-End-Prozess von der Datenerhebung (Input) über Analyse &amp; Risikobehandlung
            bis zu BI-Auswertung, Konzeptdokument und Umsetzung mit Freelancern.
          </p>
        </div>
      </div>

      <div class="two-columns">
        <div>
          <div class="section-title">Hauptphasen</div>
          <div class="cards">
            <div class="card">
              <div class="card-title">Phase 1</div>
              <div class="card-heading">Process – Planen</div>
              <div class="card-body">
                <span class="pill">
                  <span class="pill-dot"></span> Input
                </span>
                <span class="pill">
                  <span class="pill-dot"></span> Analyse / Save
                </span>
                <span class="pill">
                  <span class="pill-dot"></span> Output
                </span>
                <ul class="small-list">
                  <li>Datenerhebung (Interviews, On-site, AI)</li>
                  <li>Risikoberechnung &amp; -behandlung</li>
                  <li>Dashboards &amp; konzeptionelle Dokumente</li>
                </ul>
              </div>
            </div>

            <div class="card">
              <div class="card-title">Phase 2</div>
              <div class="card-heading">Schreibe die Anforderungen</div>
              <div class="card-body">
                <ul class="small-list">
                  <li>Text (Fachkonzept, User Stories)</li>
                  <li>Grafiken (Prozess, Architektur)</li>
                  <li>Beispielfotos (Objekte, Umfeld, Maßnahmen)</li>
                </ul>
              </div>
            </div>

            <div class="card">
              <div class="card-title">Phase 3</div>
              <div class="card-heading">Freelancer einbinden</div>
              <div class="card-body">
                <ul class="small-list">
                  <li>Finden &amp; Auswahl</li>
                  <li>Kontaktieren &amp; Briefing</li>
                  <li>Ergebnis überprüfen</li>
                </ul>
              </div>
            </div>

            <div class="card">
              <div class="card-title">Phase 4</div>
              <div class="card-heading">Testen im Feldumgebung</div>
              <div class="card-body">
                <ul class="small-list">
                  <li>Pilotierung des Project Tools</li>
                  <li>Feedback sammeln &amp; nachjustieren</li>
                  <li>Rollout vorbereiten</li>
                </ul>
              </div>
            </div>
          </div>

          <div class="section-title">Kurzüberblick Eingaben &amp; Ausgaben</div>
          <div class="cards">
            <div class="card">
              <div class="card-title">Input</div>
              <div class="card-body">
                <ul class="small-list">
                  <li>Interviews / On-site Visits</li>
                  <li>Checklisten (Audit, Environment, Object, Vulnerability)</li>
                  <li>Incident Reporting, Surveys</li>
                </ul>
              </div>
            </div>
            <div class="card">
              <div class="card-title">Analyse / Save</div>
              <div class="card-body">
                <ul class="small-list">
                  <li>Lists / Excel: Risikoberechnung</li>
                  <li>Risk Treatment (mitigate, transfer, accept, avoid)</li>
                  <li>AI: Muster &amp; Priorisierung</li>
                </ul>
              </div>
            </div>
            <div class="card">
              <div class="card-title">Output</div>
              <div class="card-body">
                <ul class="small-list">
                  <li>BI Power Dashboards (Global / Objekt)</li>
                  <li>Threat Sheet &amp; Risiko-Matrix</li>
                  <li>Konzept- &amp; Präsentationsdokumente</li>
                </ul>
              </div>
            </div>
          </div>
        </div>

        <!-- BI & Umsetzung -->
        <div>
          <div class="section-title">BI &amp; Umsetzung</div>
          <div class="cards">
            <div class="card">
              <div class="card-title">BI Power</div>
              <div class="card-heading">Risk environment risk level</div>
              <div class="card-body">
                <ul class="small-list">
                  <li>Main dashboard (Weltkarte, alle Objekte)</li>
                  <li>Object dashboard (Barometry je Objekt)</li>
                </ul>
              </div>
            </div>
            <div class="card">
              <div class="card-title">Monitoring</div>
              <div class="card-heading">Incident &amp; Surveys</div>
              <div class="card-body">
                <ul class="small-list">
                  <li>Incident KPIs: Menge, Kategorie, Status, Schaden</li>
                  <li>Security perception &amp; awareness (Survey-Auswertung)</li>
                </ul>
              </div>
            </div>
            <div class="card">
              <div class="card-title">Audit &amp; Threat Sheet</div>
              <div class="card-body">
                <ul class="small-list">
                  <li>Assets &amp; Vulnerability Monitoring</li>
                  <li>Security measures (Status, Effektivität)</li>
                  <li>Threat Sheet: Risk matrix, Threat landscape, Historie</li>
                </ul>
              </div>
            </div>
            <div class="card">
              <div class="card-title">Konzept</div>
              <div class="card-heading">Text document: Concept</div>
              <div class="card-body">
                <ul class="small-list">
                  <li>Konzept- und Präsentationsdokumente</li>
                  <li>Basis für Anforderungen und Freelancer-Briefing</li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Roadmap mit Milestones -->
    <section class="page" id="page-roadmap">
      <div class="page-header">
        <div>
          <h1>Roadmap – Milestones zum Abhaken</h1>
          <p>
            Phasenorientierte Roadmap für das Project Tool mit konkreten Milestones, die du abhaken kannst.
          </p>
        </div>
      </div>

      <div class="roadmap-summary">
        <span id="roadmap-stats">0 / 0 Milestones erledigt</span>
        <div class="progress-bar">
          <div class="progress-bar-inner" id="roadmap-progress"></div>
        </div>
      </div>

      <div class="roadmap-grid" id="roadmap-grid">
        <!-- Phase 1 -->
        <div class="card roadmap-phase">
          <div class="roadmap-phase-header">
            <div class="roadmap-phase-title">Phase 1 – Process / Planen</div>
            <div class="roadmap-phase-badge">Input &amp; Analyse</div>
          </div>
          <ul class="milestone-list">
            <li class="milestone-item">
              <input type="checkbox" id="ms-1-1" class="milestone-checkbox" />
              <label for="ms-1-1" class="milestone-label">
                Interviewleitfäden erstellen &amp; Power App vorbereiten
              </label>
            </li>
            <li class="milestone-item">
              <input type="checkbox" id="ms-1-2" class="milestone-checkbox" />
              <label for="ms-1-2" class="milestone-label">
                Erste Interviews und On-site Visits durchführen
              </label>
            </li>
            <li class="milestone-item">
              <input type="checkbox" id="ms-1-3" class="milestone-checkbox" />
              <label for="ms-1-3" class="milestone-label">
                Context, Environment &amp; Object Analysis-Checklisten ausfüllen
              </label>
            </li>
            <li class="milestone-item">
              <input type="checkbox" id="ms-1-4" class="milestone-checkbox" />
              <label for="ms-1-4" class="milestone-label">
                Vulnerability- und Threat Sheet initial befüllen
              </label>
            </li>
          </ul>
        </div>

        <!-- Phase 2 -->
        <div class="card roadmap-phase">
          <div class="roadmap-phase-header">
            <div class="roadmap-phase-title">Phase 2 – Analyse / Save</div>
            <div class="roadmap-phase-badge">Risiko &amp; Maßnahmen</div>
          </div>
          <ul class="milestone-list">
            <li class="milestone-item">
              <input type="checkbox" id="ms-2-1" class="milestone-checkbox" />
              <label for="ms-2-1" class="milestone-label">
                Risikobewertung in Listen/Excel aufsetzen
              </label>
            </li>
            <li class="milestone-item">
              <input type="checkbox" id="ms-2-2" class="milestone-checkbox" />
              <label for="ms-2-2" class="milestone-label">
                Risk level je Objekt/Standort berechnen
              </label>
            </li>
            <li class="milestone-item">
              <input type="checkbox" id="ms-2-3" class="milestone-checkbox" />
              <label for="ms-2-3" class="milestone-label">
                Maßnahmenpakete je Risiko (mitigate/transfer/accept/avoid) definieren
              </label>
            </li>
            <li class="milestone-item">
              <input type="checkbox" id="ms-2-4" class="milestone-checkbox" />
              <label for="ms-2-4" class="milestone-label">
                KI-Analyse (Trends &amp; Hotspots) konfigurieren und testen
              </label>
            </li>
          </ul>
        </div>

        <!-- Phase 3 -->
        <div class="card roadmap-phase">
          <div class="roadmap-phase-header">
            <div class="roadmap-phase-title">Phase 3 – Output / BI &amp; Konzept</div>
            <div class="roadmap-phase-badge">Visualisierung</div>
          </div>
          <ul class="milestone-list">
            <li class="milestone-item">
              <input type="checkbox" id="ms-3-1" class="milestone-checkbox" />
              <label for="ms-3-1" class="milestone-label">
                Power BI-Datenmodell für Risk Environment erstellen
              </label>
            </li>
            <li class="milestone-item">
              <input type="checkbox" id="ms-3-2" class="milestone-checkbox" />
              <label for="ms-3-2" class="milestone-label">
                Main Dashboard (Weltkarte + Objektübersicht) aufbauen
              </label>
            </li>
            <li class="milestone-item">
              <input type="checkbox" id="ms-3-3" class="milestone-checkbox" />
              <label for="ms-3-3" class="milestone-label">
                Objekt-Dashboards (Barometry, Assets, Vulnerabilities) konfigurieren
              </label>
            </li>
            <li class="milestone-item">
              <input type="checkbox" id="ms-3-4" class="milestone-checkbox" />
              <label for="ms-3-4" class="milestone-label">
                Threat Sheet &amp; Konzept-Presentation finalisieren
              </label>
            </li>
          </ul>
        </div>

        <!-- Phase 4 -->
        <div class="card roadmap-phase">
          <div class="roadmap-phase-header">
            <div class="roadmap-phase-title">Phase 4 – Anforderungen &amp; Umsetzung</div>
            <div class="roadmap-phase-badge">Realisation</div>
          </div>
          <ul class="milestone-list">
            <li class="milestone-item">
              <input type="checkbox" id="ms-4-1" class="milestone-checkbox" />
              <label for="ms-4-1" class="milestone-label">
                Anforderungen (Text, Grafiken, Beispielfotos) final ausformulieren
              </label>
            </li>
            <li class="milestone-item">
              <input type="checkbox" id="ms-4-2" class="milestone-checkbox" />
              <label for="ms-4-2" class="milestone-label">
                Geeignete Freelancer auswählen &amp; beauftragen
              </label>
            </li>
            <li class="milestone-item">
              <input type="checkbox" id="ms-4-3" class="milestone-checkbox" />
              <label for="ms-4-3" class="milestone-label">
                Ergebnisse der Freelancer reviewen &amp; integrieren
              </label>
            </li>
            <li class="milestone-item">
              <input type="checkbox" id="ms-4-4" class="milestone-checkbox" />
              <label for="ms-4-4" class="milestone-label">
                Feldtest durchführen, Feedback sammeln und Go/No-Go entscheiden
              </label>
            </li>
          </ul>
        </div>
      </div>
    </section>
  </main>

  <!-- Risiko-Modal -->
  <div id="riskModal" class="modal">
    <div class="modal-backdrop"></div>
    <div class="modal-content">
      <div class="modal-header">
        <h2 id="riskModalTitle">Neues Risiko</h2>
        <button id="riskModalClose" class="icon-btn">&times;</button>
      </div>

      <form id="riskForm" class="form">
        <input type="hidden" id="riskId" />

        <label>
          Risikoname
          <input type="text" id="riskName" required />
        </label>

        <label>
          Risikoart
          <select id="riskType" required>
            <option value="">Bitte wählen</option>
            <option value="Security">Security</option>
            <option value="Safety">Safety</option>
            <option value="Compliance">Compliance</option>
            <option value="Datenschutz">Datenschutz</option>
            <option value="Brandschutz">Brandschutz</option>
            <option value="IT">IT-Risiken</option>
          </select>
        </label>

        <label>
          Priorität
          <select id="riskPriority" required>
            <option value="Niedrig">Niedrig</option>
            <option value="Akzeptabel">Akzeptabel</option>
            <option value="Moderat">Moderat</option>
            <option value="Hoch">Hoch</option>
            <option value="Kritisch">Kritisch</option>
          </select>
        </label>

        <label>
          Status
          <select id="riskStatus" required>
            <option value="Not Started">Not Started</option>
            <option value="Ongoing">Ongoing</option>
            <option value="Erledigt">Erledigt</option>
          </select>
        </label>

        <label>
          Kurzbeschreibung
          <textarea id="riskDescription" rows="3"></textarea>
        </label>

        <h3>Eintrittswahrscheinlichkeit (Kriterien 1–5)</h3>
        <div class="form-row-2">
          <label>
            Relative Eintrittshäufigkeit (1–5)
            <input type="number" id="probFreq" min="1" max="5" value="3" />
          </label>
          <label>
            Ist-Zustand der Sicherheitsmaßnahmen (1–5, 5=gut)
            <input type="number" id="probControls" min="1" max="5" value="3" />
          </label>
        </div>
        <div class="form-row-2">
          <label>
            Anzeichen eines Schadensereignisses (1–5)
            <input type="number" id="probSigns" min="1" max="5" value="3" />
          </label>
          <label>
            Angriffskomplexität / kriminelle Energie (1–5)
            <input
              type="number"
              id="probComplexity"
              min="1"
              max="5"
              value="3"
            />
          </label>
        </div>

        <h3>Schadenausmaß (Kriterien 1–5)</h3>
        <div class="form-row-2">
          <label>
            Personenschäden (1–5)
            <input type="number" id="impPeople" min="1" max="5" value="3" />
          </label>
          <label>
            Sachschäden (1–5)
            <input type="number" id="impAssets" min="1" max="5" value="3" />
          </label>
        </div>
        <div class="form-row-2">
          <label>
            Immaterielle Schäden (1–5)
            <input
              type="number"
              id="impReputation"
              min="1"
              max="5"
              value="3"
            />
          </label>
          <label>
            Rechtliche Konsequenzen (1–5)
            <input type="number" id="impLegal" min="1" max="5" value="3" />
          </label>
        </div>
        <div class="form-row-2">
          <label>
            Interner Resistenzlevel (1–5, 5=gut)
            <input
              type="number"
              id="impResilience"
              min="1"
              max="5"
              value="3"
            />
          </label>
        </div>

        <div class="form-row-2">
          <label>
            Eintritts-Rating (auto)
            <input type="number" id="probRating" readonly />
          </label>
          <label>
            Schadens-Rating (auto)
            <input type="number" id="impRating" readonly />
          </label>
        </div>

        <div class="form-row-2">
          <label>
            Risikowert (auto)
            <input type="number" id="riskScore" readonly />
          </label>
        </div>

        <div class="modal-footer">
          <button type="button" id="riskCancel" class="secondary-btn">
            Abbrechen
          </button>
          <button type="submit" class="primary-btn">
            Speichern
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Incident-Modal -->
  <div id="incidentModal" class="modal">
    <div class="modal-backdrop"></div>

    <div class="modal-content">
      <div class="modal-header">
        <h2 id="incidentModalTitle">Neuer Vorfall</h2>
        <button id="incidentModalClose" class="icon-btn">&times;</button>
      </div>

      <form id="incidentForm" class="form">
        <input type="hidden" id="incidentId" />

        <label>
          Datum &amp; Uhrzeit
          <input type="datetime-local" id="incidentDatetime" required />
        </label>

        <label>
          Ort
          <input type="text" id="incidentLocation" required />
        </label>

        <label>
          Kategorie des Vorfalls
          <select id="incidentCategory" required>
            <option value="">Bitte wählen</option>
            <option value="Security-Vorfälle">Security-Vorfälle</option>
            <option value="Safety-Vorfälle">Safety-Vorfälle</option>
            <option value="Compliance">Compliance</option>
            <option value="Datenschutz">Datenschutz</option>
            <option value="Brandschutz">Brandschutz</option>
            <option value="IT-Vorfälle">IT-Vorfälle</option>
          </select>
        </label>

        <label>
          Art des Vorfalls
          <input
            type="text"
            id="incidentType"
            placeholder="z.B. Einbruch, Unfall, Verstoß..."
            required
          />
        </label>

        <label>
          Meldende Person
          <input type="text" id="incidentReporter" />
        </label>

        <label>
          Schweregrad
          <select id="incidentSeverity" required>
            <option value="Niedrig">Niedrig</option>
            <option value="Mittel">Mittel</option>
            <option value="Hoch">Hoch</option>
          </select>
        </label>

        <label>
          Status
          <select id="incidentStatus" required>
            <option value="offen">offen</option>
            <option value="in Bearbeitung">in Bearbeitung</option>
            <option value="geschlossen">geschlossen</option>
          </select>
        </label>

        <label>
          Verantwortliche Person
          <input type="text" id="incidentOwner" />
        </label>

        <label>
          Beschreibung des Vorfalls
          <textarea id="incidentDescription" rows="3"></textarea>
        </label>

        <div class="modal-footer">
          <button type="button" id="incidentCancel" class="secondary-btn">
            Abbrechen
          </button>
          <button type="submit" class="primary-btn">
            Speichern
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Asset-Modal -->
  <div id="assetModal" class="modal">
    <div class="modal-backdrop"></div>

    <div class="modal-content">
      <div class="modal-header">
        <h2 id="assetModalTitle">Neues Asset</h2>
        <button id="assetModalClose" class="icon-btn">&times;</button>
      </div>

      <form id="assetForm" class="form">
        <input type="hidden" id="assetId" />

        <label>
          Asset-Name
          <input type="text" id="assetName" required />
        </label>

        <label>
          Asset-Typ
          <input
            type="text"
            id="assetType"
            placeholder="z.B. Gebäude, Server, Fahrzeug"
          />
        </label>

        <label>
          Location
          <input
            type="text"
            id="assetLocation"
            placeholder="z.B. Standort, Adresse, Bereich"
          />
        </label>

        <label>
          Owner
          <input type="text" id="assetOwner" />
        </label>

        <div class="form-row-2">
          <label>
            Kritikalität (1–10)
            <input
              type="number"
              id="assetCriticality"
              min="1"
              max="10"
              value="5"
            />
          </label>
          <label>
            Schutzstatus (1–10, 10=sehr gut)
            <input
              type="number"
              id="assetProtection"
              min="1"
              max="10"
              value="5"
            />
          </label>
        </div>

        <div class="form-row-2">
          <label>
            Vulnerabilitäts-Index (auto)
            <input type="number" id="assetVulnIndex" readonly />
          </label>
          <label>
            Zone (auto)
            <input type="text" id="assetZone" readonly />
          </label>
        </div>

        <div class="modal-footer">
          <button type="button" id="assetCancel" class="secondary-btn">
            Abbrechen
          </button>
          <button type="submit" class="primary-btn">
            Speichern
          </button>
        </div>
      </form>
    </div>
  </div>

  <script>
    // ===========================
    // Helpers
    // ===========================
    const $ = (sel) => document.querySelector(sel);
    const $$ = (sel) => Array.from(document.querySelectorAll(sel));

    function createEl(tag, attrs = {}, ...children) {
      const el = document.createElement(tag);
      Object.entries(attrs).forEach(([k, v]) => {
        if (k === "class") el.className = v;
        else if (k === "dataset") {
          Object.entries(v).forEach(([dk, dv]) => (el.dataset[dk] = dv));
        } else if (k.startsWith("on") && typeof v === "function") {
          el.addEventListener(k.slice(2), v);
        } else {
          el.setAttribute(k, v);
        }
      });
      children.forEach((c) => {
        if (c == null) return;
        if (typeof c === "string") el.appendChild(document.createTextNode(c));
        else el.appendChild(c);
      });
      return el;
    }

    // In-Memory Data
    let risks = [];
    let assets = [];
    let incidents = [];
    let riskIdCounter = 1;
    let assetIdCounter = 1;
    let incidentIdCounter = 1;

    // ===========================
    // Navigation
    // ===========================
    function initNavigation() {
      const navButtons = $$(".nav-btn");
      const pages = $$(".page");

      navButtons.forEach((btn) => {
        btn.addEventListener("click", () => {
          const target = btn.dataset.page;

          navButtons.forEach((b) => b.classList.remove("active"));
          btn.classList.add("active");

          pages.forEach((p) => {
            p.classList.toggle("active", p.id === `page-${target}`);
          });
        });
      });
    }

    // ===========================
    // Dashboard
    // ===========================
    function updateDashboard() {
      let envIndex = 100;
      if (risks.length) {
        const avgRisk =
          risks.reduce((sum, r) => sum + (r.riskScore || 0), 0) / risks.length;
        envIndex = Math.max(0, Math.min(100, Math.round(100 - avgRisk)));
      }

      let objIndex = 100;
      if (assets.length) {
        const avgVuln =
          assets.reduce((sum, a) => sum + (a.vulnIndex || 0), 0) / assets.length;
        objIndex = Math.max(0, Math.min(100, Math.round(100 - avgVuln * 10)));
      }

      const openRisks = risks.filter(
        (r) => r.status !== "Erledigt" && r.status !== "Done"
      ).length;
      const openIncidents = incidents.filter(
        (i) => i.status === "offen" || i.status === "in Bearbeitung"
      ).length;

      const envIndexEl = $("#envIndex");
      const objIndexEl = $("#objIndex");
      const openRisksEl = $("#openRisks");
      const openIncidentsEl = $("#openIncidents");

      if (envIndexEl) envIndexEl.textContent = isFinite(envIndex) ? envIndex : "–";
      if (objIndexEl) objIndexEl.textContent = isFinite(objIndex) ? objIndex : "–";
      if (openRisksEl) openRisksEl.textContent = openRisks;
      if (openIncidentsEl) openIncidentsEl.textContent = openIncidents;
    }

    // ===========================
    // Risiko-Modal & Logik
    // ===========================
    let riskModal, riskForm;

    function openRiskModal(risk = null) {
      if (!riskModal) return;
      riskModal.classList.add("open");

      if (risk) {
        $("#riskModalTitle").textContent = "Risiko bearbeiten";
        $("#riskId").value = risk.id;
        $("#riskName").value = risk.name;
        $("#riskType").value = risk.type;
        $("#riskPriority").value = risk.priority;
        $("#riskStatus").value = risk.status;
        $("#riskDescription").value = risk.description || "";

        $("#probFreq").value = risk.probFreq;
        $("#probControls").value = risk.probControls;
        $("#probSigns").value = risk.probSigns;
        $("#probComplexity").value = risk.probComplexity;

        $("#impPeople").value = risk.impPeople;
        $("#impAssets").value = risk.impAssets;
        $("#impReputation").value = risk.impReputation;
        $("#impLegal").value = risk.impLegal;
        $("#impResilience").value = risk.impResilience;

        $("#probRating").value = risk.probRating;
        $("#impRating").value = risk.impRating;
        $("#riskScore").value = risk.riskScore;
      } else {
        $("#riskModalTitle").textContent = "Neues Risiko";
        riskForm.reset();
        $("#riskId").value = "";
        [
          "#probFreq",
          "#probControls",
          "#probSigns",
          "#probComplexity",
          "#impPeople",
          "#impAssets",
          "#impReputation",
          "#impLegal",
          "#impResilience",
        ].forEach((sel) => {
          const el = $(sel);
          if (el) el.value = 3;
        });
        updateRiskDerivedFields();
      }
    }

    function closeRiskModal() {
      if (riskModal) riskModal.classList.remove("open");
    }

    function calcProbRating() {
      const freq = Number($("#probFreq").value) || 0;
      const controls = Number($("#probControls").value) || 0;
      const signs = Number($("#probSigns").value) || 0;
      const complexity = Number($("#probComplexity").value) || 0;

      const invertedControls = 6 - controls;
      const invertedComplexity = 6 - complexity;

      const sum = freq + invertedControls + signs + invertedComplexity;
      return Math.round((sum / 4) * 2);
    }

    function calcImpRating() {
      const people = Number($("#impPeople").value) || 0;
      const assetsVal = Number($("#impAssets").value) || 0;
      const rep = Number($("#impReputation").value) || 0;
      const legal = Number($("#impLegal").value) || 0;
      const resilience = Number($("#impResilience").value) || 0;

      const invertedResilience = 6 - resilience;
      const sum = people + assetsVal + rep + legal + invertedResilience;
      return Math.round((sum / 5) * 2);
    }

    function calcRiskScore(probRating, impRating) {
      return probRating * impRating;
    }

    function updateRiskDerivedFields() {
      const probRating = calcProbRating();
      const impRating = calcImpRating();
      const score = calcRiskScore(probRating, impRating);

      const probRatingEl = $("#probRating");
      const impRatingEl = $("#impRating");
      const riskScoreEl = $("#riskScore");
      if (probRatingEl) probRatingEl.value = probRating;
      if (impRatingEl) impRatingEl.value = impRating;
      if (riskScoreEl) riskScoreEl.value = score;
    }

    function initRiskModal() {
      riskModal = $("#riskModal");
      riskForm = $("#riskForm");
      const btnAddRisk = $("#btnAddRisk");
      const closeBtn = $("#riskModalClose");
      const cancelBtn = $("#riskCancel");
      const backdrop = riskModal?.querySelector(".modal-backdrop");

      if (btnAddRisk) btnAddRisk.addEventListener("click", () => openRiskModal());
      if (closeBtn) closeBtn.addEventListener("click", closeRiskModal);
      if (cancelBtn) cancelBtn.addEventListener("click", closeRiskModal);
      if (backdrop)
        backdrop.addEventListener("click", (e) => {
          if (e.target === e.currentTarget) closeRiskModal();
        });

      [
        "#probFreq",
        "#probControls",
        "#probSigns",
        "#probComplexity",
        "#impPeople",
        "#impAssets",
        "#impReputation",
        "#impLegal",
        "#impResilience",
      ].forEach((sel) => {
        const el = $(sel);
        if (el) el.addEventListener("input", updateRiskDerivedFields);
      });

      if (riskForm)
        riskForm.addEventListener("submit", (e) => {
          e.preventDefault();
          const idValue = $("#riskId").value;

          const riskObj = {
            id: idValue ? Number(idValue) : riskIdCounter++,
            name: $("#riskName").value.trim(),
            type: $("#riskType").value,
            priority: $("#riskPriority").value,
            status: $("#riskStatus").value,
            description: $("#riskDescription").value.trim(),
            probFreq: Number($("#probFreq").value),
            probControls: Number($("#probControls").value),
            probSigns: Number($("#probSigns").value),
            probComplexity: Number($("#probComplexity").value),
            impPeople: Number($("#impPeople").value),
            impAssets: Number($("#impAssets").value),
            impReputation: Number($("#impReputation").value),
            impLegal: Number($("#impLegal").value),
            impResilience: Number($("#impResilience").value),
            probRating: Number($("#probRating").value),
            impRating: Number($("#impRating").value),
            riskScore: Number($("#riskScore").value),
          };

          if (!riskObj.name) {
            alert("Risikoname ist Pflicht");
            return;
          }

          if (idValue) {
            const idx = risks.findIndex((r) => r.id === riskObj.id);
            if (idx !== -1) risks[idx] = riskObj;
          } else {
            risks.push(riskObj);
          }

          closeRiskModal();
          renderRiskTable();
          renderRiskMatrix();
          updateDashboard();
        });
    }

    // ===========================
    // Risiko-Tabelle & Filter
    // ===========================
    function renderRiskTable() {
      const tbody = $("#riskTableBody");
      if (!tbody) return;
      tbody.innerHTML = "";

      const search = $("#riskSearch")?.value.trim().toLowerCase() || "";
      const typeFilter = $("#riskTypeFilter")?.value || "";

      const filtered = risks.filter((r) => {
        const matchesSearch =
          !search ||
          r.name.toLowerCase().includes(search) ||
          (r.description || "").toLowerCase().includes(search);
        const matchesType = !typeFilter || r.type === typeFilter;
        return matchesSearch && matchesType;
      });

      filtered.forEach((risk) => {
        const tr = createEl(
          "tr",
          {},
          createEl("td", {}, risk.id.toString()),
          createEl("td", {}, risk.name),
          createEl("td", {}, risk.type),
          createEl("td", {}, risk.priority),
          createEl("td", {}, risk.status),
          createEl("td", {}, risk.riskScore.toString()),
          createEl(
            "td",
            {},
            createEl(
              "button",
              {
                class: "table-action-btn",
                onclick: () => openRiskModal(risk),
              },
              "Bearbeiten"
            ),
            " ",
            createEl(
              "button",
              {
                class: "table-action-btn danger",
                onclick: () => deleteRisk(risk.id),
              },
              "Löschen"
            )
          )
        );
        tbody.appendChild(tr);
      });
    }

    function deleteRisk(id) {
      if (!confirm("Risiko wirklich löschen?")) return;
      risks = risks.filter((r) => r.id !== id);
      renderRiskTable();
      renderRiskMatrix();
      updateDashboard();
    }

    function initRiskFilters() {
      const searchEl = $("#riskSearch");
      const typeFilterEl = $("#riskTypeFilter");
      if (searchEl) searchEl.addEventListener("input", renderRiskTable);
      if (typeFilterEl) typeFilterEl.addEventListener("change", renderRiskTable);
    }

    // ===========================
    // Risikomatrix
    // ===========================
    function renderRiskMatrix() {
      const container = $("#riskMatrix");
      if (!container) return;
      container.innerHTML = "";

      const size = 10;
      const grid = createEl("div", { class: "risk-matrix-grid" });

      for (let imp = size; imp >= 1; imp--) {
        for (let prob = 1; prob <= size; prob++) {
          const cellScore = prob * imp;

          let levelClass = "low";
          if (cellScore >= 50 && cellScore < 80) levelClass = "medium";
          else if (cellScore >= 80) levelClass = "high";

          const cell = createEl("div", {
            class: `risk-matrix-cell ${levelClass}`,
          });

          const inCell = risks.filter(
            (r) => r.probRating === prob && r.impRating === imp
          );

          if (inCell.length) {
            cell.textContent = inCell.length.toString();
            cell.title = inCell.map((r) => `#$${r.id} $${r.name}`).join("\n");
          }

          grid.appendChild(cell);
        }
      }

      container.appendChild(grid);
    }

    // ===========================
    // Assets-Modal & Logik
    // ===========================
    let assetModal, assetForm;

    function calcAssetVulnIndex() {
      const crit = Number($("#assetCriticality").value) || 0;
      const prot = Number($("#assetProtection").value) || 0;
      const invertedProt = 11 - prot;
      const index = (crit * invertedProt) / 10;
      return Math.round(index * 10) / 10;
    }

    function calcAssetZone(vulnIndex) {
      if (vulnIndex >= 7) return "Rot";
      if (vulnIndex >= 4) return "Gelb";
      return "Grün";
    }

    function updateAssetDerivedFields() {
      const vuln = calcAssetVulnIndex();
      const zone = calcAssetZone(vuln);
      const vulnEl = $("#assetVulnIndex");
      const zoneEl = $("#assetZone");
      if (vulnEl) vulnEl.value = vuln;
      if (zoneEl) zoneEl.value = zone;
    }

    function openAssetModal(asset = null) {
      if (!assetModal) return;
      assetModal.classList.add("open");

      if (asset) {
        $("#assetModalTitle").textContent = "Asset bearbeiten";
        $("#assetId").value = asset.id;
        $("#assetName").value = asset.name;
        $("#assetType").value = asset.type || "";
        $("#assetLocation").value = asset.location || "";
        $("#assetOwner").value = asset.owner || "";
        $("#assetCriticality").value = asset.criticality;
        $("#assetProtection").value = asset.protection;
        $("#assetVulnIndex").value = asset.vulnIndex;
        $("#assetZone").value = asset.zone;
      } else {
        $("#assetModalTitle").textContent = "Neues Asset";
        assetForm.reset();
        $("#assetId").value = "";
        const critEl = $("#assetCriticality");
        const protEl = $("#assetProtection");
        if (critEl) critEl.value = 5;
        if (protEl) protEl.value = 5;
        updateAssetDerivedFields();
      }
    }

    function closeAssetModal() {
      if (assetModal) assetModal.classList.remove("open");
    }

    function initAssetModal() {
      assetModal = $("#assetModal");
      assetForm = $("#assetForm");
      const btnAddAsset = $("#btnAddAsset");
      const closeBtn = $("#assetModalClose");
      const cancelBtn = $("#assetCancel");
      const backdrop = assetModal?.querySelector(".modal-backdrop");

      if (btnAddAsset)
        btnAddAsset.addEventListener("click", () => openAssetModal());
      if (closeBtn) closeBtn.addEventListener("click", closeAssetModal);
      if (cancelBtn) cancelBtn.addEventListener("click", closeAssetModal);
      if (backdrop)
        backdrop.addEventListener("click", (e) => {
          if (e.target === e.currentTarget) closeAssetModal();
        });

      ["#assetCriticality", "#assetProtection"].forEach((sel) => {
        const el = $(sel);
        if (el) el.addEventListener("input", updateAssetDerivedFields);
      });

      if (assetForm)
        assetForm.addEventListener("submit", (e) => {
          e.preventDefault();
          const idValue = $("#assetId").value;

          const vulnIndex = Number($("#assetVulnIndex").value);
          const zone = $("#assetZone").value;

          const assetObj = {
            id: idValue ? Number(idValue) : assetIdCounter++,
            name: $("#assetName").value.trim(),
            type: $("#assetType").value.trim(),
            location: $("#assetLocation").value.trim(),
            owner: $("#assetOwner").value.trim(),
            criticality: Number($("#assetCriticality").value),
            protection: Number($("#assetProtection").value),
            vulnIndex,
            zone,
          };

          if (!assetObj.name) {
            alert("Asset-Name ist Pflicht");
            return;
          }

          if (idValue) {
            const idx = assets.findIndex((a) => a.id === assetObj.id);
            if (idx !== -1) assets[idx] = assetObj;
          } else {
            assets.push(assetObj);
          }

          closeAssetModal();
          renderAssetTable();
          updateDashboard();
        });
    }

    // Asset-Tabelle & Filter
    function renderAssetTable() {
      const tbody = $("#assetTableBody");
      if (!tbody) return;
      tbody.innerHTML = "";

      const search = $("#assetSearch")?.value.trim().toLowerCase() || "";
      const zoneFilter = $("#assetZoneFilter")?.value || "";

      const filtered = assets.filter((a) => {
        const matchesSearch =
          !search ||
          a.name.toLowerCase().includes(search) ||
          (a.type || "").toLowerCase().includes(search) ||
          (a.location || "").toLowerCase().includes(search) ||
          (a.owner || "").toLowerCase().includes(search);
        const matchesZone = !zoneFilter || a.zone === zoneFilter;
        return matchesSearch && matchesZone;
      });

      filtered.forEach((asset) => {
        const tr = createEl(
          "tr",
          {},
          createEl("td", {}, asset.id.toString()),
          createEl("td", {}, asset.name),
          createEl("td", {}, asset.type || "–"),
          createEl("td", {}, asset.location || "–"),
          createEl("td", {}, asset.owner || "–"),
          createEl("td", {}, asset.vulnIndex.toString()),
          createEl("td", {}, asset.zone),
          createEl(
            "td",
            {},
            createEl(
              "button",
              {
                class: "table-action-btn",
                onclick: () => openAssetModal(asset),
              },
              "Bearbeiten"
            ),
            " ",
            createEl(
              "button",
              {
                class: "table-action-btn danger",
                onclick: () => deleteAsset(asset.id),
              },
              "Löschen"
            )
          )
        );
        tbody.appendChild(tr);
      });
    }

    function deleteAsset(id) {
      if (!confirm("Asset wirklich löschen?")) return;
      assets = assets.filter((a) => a.id !== id);
      renderAssetTable();
      updateDashboard();
    }

    function initAssetFilters() {
      const searchEl = $("#asset
